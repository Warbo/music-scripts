#! /usr/bin/env nix-shell
#! nix-shell -i bash -p xidel -p jsbeautifier -p xvfb_run -p xdotool -p xsel

BASE=$(dirname "$(readlink -f "$0")")

function scrapeWithFirefox {
    URL="$1" xvfb-run "$BASE/ff.sh" | while read -r LINE
    do
        if echo "$LINE" | grep "^http" > /dev/null
        then
            echo "$LINE"
        else
            echo "$LINE" 1>&2
        fi
    done
}

# Loop over result links, getting videos and obfuscated javascript
while read -r LNK
do
    echo "Scraping page '$LNK'" 1>&2
    scrapepage "$LNK"
done < <(scrapeWithFirefox "$1")
