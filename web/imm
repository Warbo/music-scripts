#! /usr/bin/env nix-shell
#! nix-shell -i bash -p python

# Run any RSS-generating scripts we might have
pull_down_rss

# Serve local RSS files since imm is HTTP only :/
pushd ~/.cache
python -m SimpleHTTPServer 8888 &
SERVER_PID="$!"
popd

# Run imm to send RSS to mailbox
nix-shell --show-trace --pure \
          -p '(haskellPackages.ghcWithPackages (h: [ h.imm ]))' \
          --run "export LANG='en_GB.UTF-8'; imm $*"

# Kill local server
kill "$SERVER_PID"
